<script src="BCa-comments_files/header-attrs/header-attrs.js"></script>
<link href="BCa-comments_files/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="BCa-comments_files/anchor-sections/anchor-sections.js"></script>


<pre class="r"><code>meanlike &lt;- function(x){
 n&lt;- length(x)

f1&lt;- function(lambda,x){
     x/(n-lambda*x)
    }

 sx&lt;- sort(x)
 nt&lt;- 40
 nlam&lt;-40
 th&lt;- seq(1.01*sx[1],(sx[n-1]+.99*(sx[n]-sx[n-1])),len=nt)
 theta&lt;- NULL
 loglik&lt;- NULL
 for (i in 1:nt){
   a&lt;- x-th[i]
   lam &lt;- seq(n/min(a),n/max(a),len=nlam)
   lam &lt;- lam[c(-1,-nlam)]
   glam &lt;-outer(lam,a,&#39;f1&#39;)
   glam&lt;- c(glam %*% rep(1,n))
   lam0&lt;- approx(glam,lam,xout=0)$y
   if (is.na(lam0)==F) {   # lam0 exists
      w &lt;- 1/(n-lam0*a)
      if (min(w)&gt;0 &amp; max(w)&lt;1){  # proper distribution
        ll&lt;- sum(log(w))
        theta&lt;- c(theta,th[i])
        loglik &lt;- c(loglik,ll)
      }
   } # endif
 }# endfor

 loglik&lt;- loglik - max(loglik)
 out &lt;- list(theta= theta, loglik=loglik)
 return(out)
} # end function

# aircraft failure data:
x&lt;- c(50,44,102,72,22,39,3,15,197,188,79,88,46,5,5,
     36,22,139,210,97,30,23,13,14)
n&lt;- length(x)

v0&lt;- mean(x)
# bootstrap step:
  nb&lt;- 1000
.Random.seed&lt;- c(0,1999,7,29)  # today&#39;s date
  xstar&lt;- sample(x,n*nb,repl=T)</code></pre>
<pre><code>## Warning in sample.int(length(x), size, replace, prob): &#39;.Random.seed&#39; n&#39;est pas
## un vecteur d&#39;entiers, mais est de type &#39;double&#39;, et sera donc ignor√©</code></pre>
<pre class="r"><code>  xstar&lt;- matrix(xstar,ncol=n) # 24 columns, 1000 rows, each row is a bootstrap
  vstar&lt;- c(xstar%*% rep(1,n)/n) 
  # X %*% rep(1,n) returns rowsums, so here returns the mean for each bootstrap sample

# bootstrap 
  nt &lt;- 40
  phi0&lt;- qnorm(sum(vstar&lt;v0)/nb)
  # proportion of bootstrap means that is less than observed sample mean
  # ie G_hat(theta_hat), where the hat in the former means G is based on bootstrap and latter means theta is based on observed sample
  
  # qnorm is the normalizing transform; if G is known (not G_hat, which is based on bootstrap), 
  # then qnorm(.) gives the standard normal
  
  # grid of theta 
  th&lt;- seq((min(vstar)+1),(max(vstar)-1),len=nt)
  
  # phi is to store the qnorm(.) evaluated at at different bootstrap means (to get distribution)
  # that distribution is G_hat(theta)
  phi&lt;- rep(0,nt)
  for (i in 1:nt){
    phi[i]&lt;- qnorm(sum(vstar&lt;th[i])/nb)
  }
  
  # a is the rate of change of a standard deviation of the normalized parameter
  # for mean this measure the skewness of the data
  a&lt;- sum((x-mean(x))^3)/6/sum((x-mean(x))^2)^1.5

  
  #----
  # for general parameter, alpha is computed with jackknife procedure
  # the jackknife procedure to find theta_hat_(i) (estimated by sample with i_th sample taken out)
  mean_jackknife_est &lt;- vector(mode = &quot;integer&quot;, length = length(x) - 1)
  for (i in seq_along(x)) {
    mean_jackknife_est[i] &lt;- mean(x[-i])
  }
  mean_jackknife_est_mean &lt;- mean(mean_jackknife_est)
a_jackknife &lt;- 
  sum((mean_jackknife_est_mean - mean_jackknife_est)^3)/6/sum((mean_jackknife_est_mean - mean_jackknife_est)^2)^1.5
# note a and a_jackknife are the same
  #----
   
  
  s &lt;- 1+ a*(phi-phi0)

  pmean &lt;- - phi0*s + phi   # see p.416                                                                                                                                             
  ln&lt;- dnorm(phi0,mean=pmean,sd=s)    #.... BCa likelihood
  bcall &lt;- log(ln) - max(log(ln))     #! I think this is to make it on the same scale

empll&lt;- meanlike(x)   # empirical likelihood

plot(th,bcall, xlab=expression(theta),
   ylab=&#39;Log-likelihood&#39;,type=&#39;n&#39;)+
   lines(th,bcall,lwd=.3)+
   abline(v=mean(x),lwd=.3) +
   lines(empll[[1]],empll[[2]],lty=2)</code></pre>
<p><img src="BCa-comments_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre><code>## integer(0)</code></pre>
